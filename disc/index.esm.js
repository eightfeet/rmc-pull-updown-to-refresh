import t,{Component as e}from"react";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},o(t,e)};function r(t,e,o){var r,n,i,s=Math.abs(e)/Math.abs(t),l=Math.tan(function(t){return t*(Math.PI/180)}(o));return r=s,n=l,i=Number.EPSILON,Math.abs(r-n)<i?0:s>l?1:-1}var n={rootbox:"PullToRefresh_rootbox__Gy9qk",drogbox:"PullToRefresh_drogbox__hntGN",listwrap:"PullToRefresh_listwrap__OnOwX",listcontent:"PullToRefresh_listcontent__3FrYw",drogbar:"PullToRefresh_drogbar__baIiv",loading:"PullToRefresh_loading__ivKA3",top:"PullToRefresh_top__YS33d",buttom:"PullToRefresh_buttom__K1gr1",loadingline:"PullToRefresh_loadingline__4Qp2-",arrowico:"PullToRefresh_arrowico__SaCAe",loadingico:"PullToRefresh_loadingico__K4szf",error:"PullToRefresh_error__6QoXX",loadingtext:"PullToRefresh_loadingtext__OtEKs",arrowup:"PullToRefresh_arrowup__2-Gyh",debug:"PullToRefresh_debug__GjXyo"};!function(t,e){void 0===e&&(e={});var o=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===o&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}(".PullToRefresh_rootbox__Gy9qk{height:100%;overflow:hidden;position:relative;width:100%}.PullToRefresh_drogbox__hntGN{left:0;position:absolute;transition-duration:0s;width:100%}.PullToRefresh_listwrap__OnOwX{-webkit-overflow-scrolling:touch;overflow:auto;position:relative}.PullToRefresh_listcontent__3FrYw{box-sizing:border-box;width:100%}.PullToRefresh_drogbar__baIiv{background-color:#eee;color:#888;font-size:smaller;position:relative}.PullToRefresh_loading__ivKA3{align-items:center;display:flex;height:50px;justify-content:center;position:absolute;width:100%}.PullToRefresh_top__YS33d{bottom:0}.PullToRefresh_buttom__K1gr1{top:0}.PullToRefresh_loadingline__4Qp2-{align-items:center;color:#888;display:flex;font-size:smaller;font-size:10px;height:20px;justify-content:center;line-height:0;width:100%}.PullToRefresh_arrowico__SaCAe,.PullToRefresh_loadingico__K4szf{height:1rem;transform-origin:center;width:1rem}.PullToRefresh_arrowico__SaCAe svg,.PullToRefresh_loadingico__K4szf svg{display:block;height:100%;width:100%}.PullToRefresh_error__6QoXX,.PullToRefresh_loadingtext__OtEKs{color:#888}.PullToRefresh_arrowup__2-Gyh{transform:rotate(180deg);transform-origin:center}.PullToRefresh_debug__GjXyo{background-color:rgba(0,0,0,.4);bottom:0;color:red;position:absolute;width:100%}");var i=t.createElement("span",{className:n.loadingico},t.createElement("svg",{className:"lds-palette-ring",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},t.createElement("g",{transform:"rotate(150 50 50)"},t.createElement("path",{d:"M80 50a30 30 0 0 1-20.73 28.532",fill:"none",stroke:"#ffffcb",strokeWidth:10}),t.createElement("path",{d:"M59.27 78.532a30 30 0 0 1-33.54-10.898",fill:"none",stroke:"#fac090",strokeWidth:10}),t.createElement("path",{d:"M25.73 67.634a30 30 0 0 1 0-35.268",fill:"none",stroke:"#ff7c81",strokeWidth:10}),t.createElement("path",{d:"M25.73 32.366a30 30 0 0 1 33.54-10.898",fill:"none",stroke:"#c0f6d2",strokeWidth:10}),t.createElement("path",{d:"M59.27 21.468A30 30 0 0 1 80 50",fill:"none",stroke:"#dae4bf",strokeWidth:10}),t.createElement("animateTransform",{attributeName:"transform",type:"rotate",values:"0 50 50;360 50 50",dur:1,repeatCount:"indefinite"})))),s=t.createElement("span",{className:n.arrowico},t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"-359 361 80 80",xmlSpace:"preserve"},t.createElement("path",{d:"M-322.2 373.6c-12.6 1.4-22.7 11.5-24.2 24.1-1.5 12.8 5.7 24.1 16.6 28.8 0-2.5-1.2-4.9-3.2-6.4-6.6-4.9-10.5-13.1-9.3-22.2 1.4-10.6 10.1-19.1 20.7-20.3 14.2-1.6 26.3 9.6 26.3 23.5 0 12.4-9.5 22.5-21.6 23.5v-30l3.4 3.4c1.3 1.3 3.4.4 3.4-1.4v-.1c0-.5-.2-1-.6-1.4l-6.8-6.8c-.8-.8-2-.8-2.8 0l-6.8 6.8c-.4.4-.6.9-.6 1.4v.1c0 1.8 2.2 2.7 3.4 1.4l3.4-3.4v34c.7 0 1.3.1 2 .1 15.2 0 27.6-12.4 27.6-27.6-.1-16.4-14.2-29.4-30.9-27.5z",fill:"currentColor"}))),l=/Android 4./i.test(navigator.userAgent),a=function(e){function a(t){var o=e.call(this,t)||this;return o.init=function(){setTimeout((function(){var t,e;o.onAddTouchEventListener(),o.pageHeight=null===(e=null===(t=o.rootbox)||void 0===t?void 0:t.parentElement)||void 0===e?void 0:e.clientHeight,o.pageHeight||(console.warn("rmc-pull-updown-to-refresh:The parent HTML element of the component has no height, please set it, otherwise the component will be set as the window height！"),o.pageHeight=window.innerHeight),o.originTransfrom=-1*o.pageHeight,o.setState({rootHeight:o.pageHeight,transfrom:o.originTransfrom})}),100)},o.stateInit=function(){o.setState({loadingtext:null,showLoading:!1,showArrow:!1,errMsg:null,arrowRotate:0,transfrom:o.originTransfrom,debug:null}),o.offset=0,o.distence=0,o.step=300,window.clearTimeout(o.timererror),window.clearTimeout(o.delaytimer),o.isStatusLoading=!1,o.isTouch=!1},o.isOnScroll=function(){var t,e,r=(null===(t=o.listwrap)||void 0===t?void 0:t.offsetHeight)||0,n=(null===(e=o.listcontent)||void 0===e?void 0:e.offsetHeight)||0,i=(o.listwrap||{}).scrollTop,s=void 0===i?0:i;return!(r+s+1>=n||0===s)&&(o.isScroll||o.stateInit(),!0)},o.onScroll=function(){o.isScroll=o.isOnScroll()},o.onAddTouchEventListener=function(){o.drogbox&&o.listwrap&&(o.drogbox.addEventListener("touchstart",o.onTouchStart,!1),o.drogbox.addEventListener("touchmove",o.onTouchMove,!1),o.drogbox.addEventListener("touchend",o.onTouchEnd,!1),o.listwrap.addEventListener("scroll",o.onScroll,!1))},o.onRemoveTouchEventListener=function(){o.drogbox&&o.listwrap&&(o.drogbox.removeEventListener("touchstart",o.onTouchStart),o.drogbox.removeEventListener("touchmove",o.onTouchMove),o.drogbox.removeEventListener("touchend",o.onTouchEnd),o.listwrap.removeEventListener("scroll",o.onScroll))},o.onTouchStart=function(t){var e,r;if(!o.isScroll&&!o.isStatusLoading){var n=(null===(e=o.listwrap)||void 0===e?void 0:e.offsetHeight)||0,i=(null===(r=o.listcontent)||void 0===r?void 0:r.offsetHeight)||0,s=(o.listwrap||{}).scrollTop,a=void 0===s?0:s;if(o.isTouch)l&&n+a+1>=i&&t.preventDefault();else{o.isTouch=!0;var c=t.changedTouches[0];o.startPos=c.screenY,o.startXPos=c.screenX,o.initialDirection=null}}},o.onTouchMove=function(t){var e,n,i,s,l;if(!o.isScroll&&!o.isStatusLoading&&o.isTouch){var a=(null===(e=o.listwrap)||void 0===e?void 0:e.offsetHeight)||0,c=(null===(n=o.listcontent)||void 0===n?void 0:n.offsetHeight)||0,d=(o.listwrap||{}).scrollTop,u=void 0===d?0:d;0===(null===(i=o.listwrap)||void 0===i?void 0:i.scrollTop)&&o.endPos-o.startPos>0&&t.cancelable&&t.preventDefault(),o.listwrap&&o.listwrap.scrollTop+o.listwrap.clientHeight===o.listwrap.scrollHeight&&o.endPos-o.startPos<0&&t.cancelable&&t.preventDefault();var h=t.changedTouches[0];if(o.endPos=h.screenY,o.endXPos=h.screenX,!(r(o.endXPos-o.startXPos,o.endPos-o.startPos,60)<1||(o.distence=o.endPos-o.startPos,o.initialDirection||(o.distence>10&&!o.props.disablePullDown&&(o.initialDirection=1),o.distence<-10&&!o.props.disablePullUp&&(o.initialDirection=-1)),1===o.initialDirection&&0===(null===(s=o.listwrap)||void 0===s?void 0:s.scrollTop)&&o.props.disablePullDown||-1===o.initialDirection&&a+u+1>=c&&o.props.disablePullUp))){var f=o.endPos-o.startPos<100?100:o.endPos-o.startPos;o.endPos<o.startPos&&(f*=-1),(o.endPos>o.startPos&&0!==(null===(l=o.listwrap)||void 0===l?void 0:l.scrollTop)||o.endPos<o.startPos&&a+u+1<c)&&(f=0),o.offset=(o.step-=2)/f,o.offset===1/0&&(o.offset=-1),(o.props.disablePullDown&&o.offset>0||o.props.disablePullUp&&o.offset<0)&&(o.offset=0);var p=o.state.arrowRotate,g=p<180?p+=8:180,m=null;1===o.initialDirection&&(m=o.props.pullDownText),-1===o.initialDirection&&(m=o.props.pullUpText),-1===o.initialDirection&&o.distence>0||1===o.initialDirection&&o.distence<0||o.setState({errMsg:null,transfrom:(o.state.transfrom||0)+o.offset,loadingtext:m,showArrow:!0,showLoading:!1,arrowRotate:g})}}},o.onTouchEnd=function(t){if(o.isScroll)return!0;if(o.isStatusLoading)return!0;if(!o.isTouch)return!0;o.isStatusLoading=!0;var e=Math.abs(Math.abs(o.originTransfrom)-Math.abs(o.state.transfrom||0)),r=t.changedTouches[0];o.endPos=r.screenY;var n=null;return e>o.minDistance?(-1===o.initialDirection&&(n=o.originTransfrom-o.minDistance),1===o.initialDirection&&(n=o.originTransfrom+o.minDistance)):n=o.originTransfrom,o.setState({transfrom:n,loadingtext:o.props.loadingText,showLoading:!0,showArrow:!1,arrowRotate:0},(function(){o.isTouch=!1,o.offset=0,o.step=300,o.handleAction(o.initialDirection||0)})),!0},o.handleAction=function(t){var e=null;return-1===t&&(e=o.originTransfrom-o.minDistance),1===t&&(e=o.originTransfrom+o.minDistance),Promise.resolve().then((function(){return-1!==t||o.props.disablePullUp?1===t&&!o.props.disablePullDown&&(o.props.onPullDown&&o.props.onPullDown()):o.props.onPullUp&&o.props.onPullUp()})).then((function(){return o.setState({transfrom:o.originTransfrom,loadingtext:null,showLoading:!1,showArrow:!1},(function(){o.stateInit()})),"RefreshSuccess"})).catch((function(t){o.setState({transfrom:e,loadingtext:null,showLoading:!1,showArrow:!1,errMsg:t}),window.clearTimeout(o.timererror),o.timererror=window.setTimeout((function(){o.setState({transfrom:o.originTransfrom,errMsg:null},(function(){o.stateInit()}))}),3e3)}))},o.state={rootHeight:0,transfrom:0,loadingtext:null,showArrow:!1,showLoading:!1,arrowRotate:0,errMsg:null},o.rootbox=null,o.drogbox=null,o.listwrap=null,o.listcontent=null,o.offset=0,o.startPos=0,o.endPos=0,o.startXPos=0,o.endXPos=0,o.originTransfrom=0,o.isTouch=!1,o.isScroll=!1,o.minDistance=50,o.step=300,o.timererror=void 0,o.delaytimer=void 0,o.isStatusLoading=!1,o.distence=0,o.initialDirection=null,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(a,e),a.prototype.componentDidMount=function(){this.init()},a.prototype.componentWillUnmount=function(){this.onRemoveTouchEventListener()},a.prototype.render=function(){var e=this,o=this.state,r=o.debug,i=o.rootHeight,s=o.transfrom,l=o.loadingtext,a=o.showLoading,c=o.showArrow,d=o.arrowRotate,u=o.errMsg,h=this.props.className,f={height:"".concat(2*i,"px"),transform:"matrix(1, 0, 0, 1, 0, ".concat(s,")"),WebkitTransform:"matrix(1, 0, 0, 1, 0, ".concat(s,")")},p={transform:"rotate(".concat(d,"deg)"),WebkitTransform:"rotate(".concat(d,"deg)")},g={height:"".concat(i,"px"),width:"100%",position:"relative"};return t.createElement("div",{ref:function(t){e.rootbox=t},style:{height:"".concat(this.pageHeight,"px")},className:"".concat(n.rootbox," ").concat(h||"")},r&&t.createElement("div",{className:n.debug},r),t.createElement("div",{ref:function(t){e.drogbox=t},className:n.drogbox,style:f},t.createElement("div",{className:"".concat(n.drogbar," ").concat(this.props.loadingClassName),style:g},t.createElement("div",{className:"".concat(n.top," ").concat(n.loading)},a&&this.props.loadIcon,c&&t.createElement("span",{className:n.arrowico,style:p},t.createElement("div",{className:n.arrowup},this.props.pullIcon)),l,u)),t.createElement("div",{ref:function(t){e.listwrap=t},className:n.listwrap,style:{height:"".concat(i,"px")}},t.createElement("div",{ref:function(t){e.listcontent=t}},this.props.children)),t.createElement("div",{className:"".concat(n.drogbar," ").concat(this.props.loadingClassName),style:g},t.createElement("div",{className:n.loading},a&&this.props.loadIcon,c&&t.createElement("span",{className:n.arrowico,style:p},t.createElement("span",{className:n.arrowbottom},this.props.pullIcon)),l,u))))},a.defaultProps={pullDownText:"下拉刷新",pullUpText:"查看更多",loadingText:"加载中",loadingClassName:"",loadIcon:i,pullIcon:s},a}(e);export{a as default};
